<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Boudhina Shop | Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ©</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #FFD700;
            --whatsapp: #25D366;
            --bg: #0b0b0b;
            --card: #161616;
            --text: #ffffff;
            --text-muted: #a0a0a0;
            --nav-bg: rgba(10, 10, 10, 0.98);
            --input-bg: #1f1f1f;
        }

        body {
            margin: 0; font-family: 'Cairo', sans-serif;
            background: var(--bg); color: var(--text);
            transition: 0.3s; padding-bottom: 90px;
        }

        header {
            display: flex; justify-content: center; align-items: center;
            padding: 15px 20px; background: var(--nav-bg); position: sticky; top: 0; z-index: 1000;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        .brand { font-weight: 800; font-size: 22px; color: var(--primary); }

        .section { display: none; padding: 10px 20px; max-width: 600px; margin: auto; animation: fadeIn 0.4s; }
        .active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .search-box { position: relative; margin: 15px 0; }
        .search-box i { position: absolute; left: 15px; top: 50%; transform: translateY(-50%); color: var(--text-muted); }
        .search-box input { width: 100%; padding: 12px 40px 12px 15px; border-radius: 15px; border: none; background: var(--input-bg); color: var(--text); outline: none; box-sizing: border-box; }

        .card { background: var(--card); border-radius: 20px; overflow: hidden; margin-bottom: 20px; border: 1px solid rgba(255,255,255,0.05); }
        .card-img { width: 100%; height: 200px; object-fit: cover; }
        .card-content { padding: 15px; }
        .price { color: var(--primary); font-weight: 800; font-size: 18px; }

        .method-tag { font-size: 11px; background: rgba(255, 215, 0, 0.1); color: var(--primary); padding: 2px 8px; border-radius: 5px; margin-bottom: 10px; display: inline-block; }

        .btn-main { background: var(--primary); color: #000; padding: 12px; border: none; border-radius: 12px; width: 100%; font-weight: 800; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; font-size: 14px; transition: 0.2s; margin-top: 5px; }
        .btn-wa { background: var(--whatsapp); color: #fff; }
        .btn-chat { background: #333; color: #fff; }

        .nav {
            position: fixed; bottom: 0; width: 100%; height: 70px;
            background: var(--nav-bg); display: flex; justify-content: space-around; align-items: center;
            border-top: 1px solid rgba(255,255,255,0.05); backdrop-filter: blur(10px);
        }
        .nav-btn { background: none; border: none; color: #666; font-size: 22px; cursor: pointer; }
        .nav-btn.active-link { color: var(--primary); }

        .chat-msg { background: var(--input-bg); padding: 12px; border-radius: 12px; margin-bottom: 10px; border-right: 4px solid var(--primary); }
        
        input, textarea, select { width: 100%; padding: 12px; margin: 8px 0; border-radius: 12px; border: none; background: var(--input-bg); color: var(--text); box-sizing: border-box; font-family: 'Cairo'; }
        
        #auth-screen { position: fixed; inset: 0; background: #000; z-index: 2000; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 30px; text-align: center; }
    </style>
</head>
<body class="dark-mode">

    <div id="auth-screen">
        <i class="fa-solid fa-store" style="font-size: 60px; color: var(--primary); margin-bottom: 20px;"></i>
        <h1 style="margin-bottom: 5px;">Boudhina Shop</h1>
        <p style="color: #666; margin-bottom: 30px;">Ø³ÙˆÙ‚ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø§Ù„Ø£ÙˆÙ„ ÙÙŠ ØªÙˆÙ†Ø³</p>
        <input type="text" id="reg-name" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ¹Ø§Ø±">
        <input type="email" id="reg-email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
        <button class="btn-main" onclick="register()">Ø§Ø¨Ø¯Ø£ Ø±Ø­Ù„ØªÙƒ</button>
    </div>

    <header><div class="brand">Boudhina Shop</div></header>

    <div id="home" class="section active">
        <div class="search-box">
            <i class="fa-solid fa-search"></i>
            <input type="text" id="searchInput" onkeyup="searchPosts()" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù„Ø¹Ø¨Ø© (Free Fire, PUBG...)">
        </div>
        <div id="postsList"></div>
    </div>

    <div id="sell" class="section">
        <h2 style="text-align: center;">Ø§Ù†Ø´Ø± Ø¹Ø±Ø¶ Ø¬Ø¯ÙŠØ¯</h2>
        <input type="text" id="gameCat" placeholder="Ø§Ø³Ù… Ø§Ù„Ù„Ø¹Ø¨Ø©">
        <input type="number" id="price" placeholder="Ø§Ù„Ø³Ø¹Ø± Ø¨Ù€ DT">
        <input type="tel" id="waPhone" placeholder="Ø±Ù‚Ù… ÙˆØ§ØªØ³Ø§Ø¨ Ù„Ù„Ø§ØªÙØ§Ù‚">
        <input type="number" id="d17Num" placeholder="Ø±Ù‚Ù… D17 (Ø§Ø®ØªÙŠØ§Ø±ÙŠ Ù„Ù„Ø´Ø±Ø§Ø¡ Ø¹Ù† Ø¨Ø¹Ø¯)">
        <select id="dealMethod">
            <option value="both">Ø¹Ù† Ø¨Ø¹Ø¯ + ØªÙˆØ§ØµÙ„ Ø¯Ø§Ø®Ù„ÙŠ</option>
            <option value="remote">Ø¹Ù† Ø¨Ø¹Ø¯ ÙÙ‚Ø· (D17)</option>
            <option value="inApp">ØªÙˆØ§ØµÙ„ Ø¯Ø§Ø®Ù„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙÙ‚Ø·</option>
        </select>
        <textarea id="desc" rows="3" placeholder="ÙˆØµÙ Ø§Ù„Ø­Ø³Ø§Ø¨ (Ø§Ù„Ù…Ø³ØªÙˆÙ‰ØŒ Ø§Ù„Ø³ÙƒÙ†Ø§Øª...)"></textarea>
        <div style="background: var(--input-bg); padding: 15px; border-radius: 12px; text-align: center; border: 2px dashed #444;">
            <input type="file" id="fileInput" accept="image/*" onchange="handleImage(event)" style="padding: 0;">
            <p style="font-size: 12px; color: #666; margin: 5px 0 0 0;">Ø§Ø®ØªØ± ØµÙˆØ±Ø© Ø§Ù„Ø­Ø³Ø§Ø¨</p>
        </div>
        <button class="btn-main" style="margin-top: 20px;" onclick="savePost()">Ù†Ø´Ø± Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø¢Ù†</button>
    </div>

    <div id="profile" class="section">
        <div style="text-align:center; padding: 20px; background: var(--card); border-radius: 20px; margin-bottom: 20px;">
            <i class="fa-solid fa-circle-user" style="font-size: 50px; color: var(--primary);"></i>
            <h2 id="profile-name" style="margin: 10px 0 0 0;">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</h2>
            <p id="profile-email" style="color:#666; font-size: 14px;"></p>
        </div>
        
        <h3><i class="fa-solid fa-comments"></i> Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ÙˆØ§Ø±Ø¯Ø©</h3>
        <div id="messagesList"></div>

        <h3 style="margin-top:25px;"><i class="fa-solid fa-box"></i> Ø¹Ø±ÙˆØ¶ÙŠ Ø§Ù„Ø­Ø§Ù„ÙŠØ©</h3>
        <div id="myPostsList"></div>
        
        <button class="btn-main" style="background:#ff5252; color:#fff; margin-top:40px;" onclick="logout()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
    </div>

    <nav class="nav">
        <button class="nav-btn active-link" onclick="showPage('home', this)"><i class="fa-solid fa-house"></i></button>
        <button class="nav-btn" onclick="showPage('sell', this)"><i class="fa-solid fa-circle-plus"></i></button>
        <button class="nav-btn" onclick="showPage('profile', this)"><i class="fa-solid fa-user-gear"></i></button>
    </nav>

    <script>
        let currentImg = "";

        // Ø§Ù„ØªØ³Ø¬ÙŠÙ„
        function register() {
            const name = document.getElementById('reg-name').value;
            const email = document.getElementById('reg-email').value;
            if(!name || !email) return alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ù…Ù„Ø¡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");
            localStorage.setItem('user', JSON.stringify({name, email}));
            location.reload();
        }

        // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ØµÙˆØ±Ø©
        function handleImage(e) {
            const reader = new FileReader();
            reader.onload = () => currentImg = reader.result;
            reader.readAsDataURL(e.target.files[0]);
        }

        // Ø­ÙØ¸ Ø§Ù„Ù…Ù†Ø´ÙˆØ±
        function savePost() {
            const game = document.getElementById('gameCat').value;
            const price = document.getElementById('price').value;
            const phone = document.getElementById('waPhone').value;
            const d17 = document.getElementById('d17Num').value;
            const method = document.getElementById('dealMethod').value;
            const desc = document.getElementById('desc').value;
            const user = JSON.parse(localStorage.getItem('user'));

            if(!game || !price || !currentImg) return alert("Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„ØµÙˆØ±Ø©!");

            const posts = JSON.parse(localStorage.getItem('gamePosts') || "[]");
            posts.unshift({ id: Date.now(), game, price, phone, d17, method, desc, img: currentImg, user: user.name, email: user.email });
            localStorage.setItem('gamePosts', JSON.stringify(posts));
            alert("ØªÙ… Ø§Ù„Ù†Ø´Ø± ÙÙŠ Ø§Ù„Ø³ÙˆÙ‚!");
            location.reload();
        }

        // Ø§Ù„Ø¨Ø­Ø«
        function searchPosts() {
            const q = document.getElementById('searchInput').value.toLowerCase();
            document.querySelectorAll('#postsList .card').forEach(c => {
                c.style.display = c.innerText.toLowerCase().includes(q) ? "" : "none";
            });
        }

        // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª
        function renderPosts() {
            const posts = JSON.parse(localStorage.getItem('gamePosts') || "[]");
            const list = document.getElementById('postsList');
            list.innerHTML = "";
            
            posts.forEach(p => {
                let tag = p.method === 'remote' ? 'âš¡ Ø´Ø±Ø§Ø¡ Ø¹Ù† Ø¨Ø¹Ø¯' : (p.method === 'inApp' ? 'ğŸ’¬ ØªÙˆØ§ØµÙ„ Ø¯Ø§Ø®Ù„ÙŠ' : 'ğŸ”„ Ù…ØªØ§Ø­ Ø¹Ù† Ø¨Ø¹Ø¯ + Ø¯Ø§Ø®Ù„ÙŠ');
                
                list.innerHTML += `
                    <div class="card">
                        <img class="card-img" src="${p.img}">
                        <div class="card-content">
                            <span class="method-tag">${tag}</span>
                            <div style="display:flex; justify-content:space-between; align-items:center;">
                                <b style="font-size:18px">${p.game}</b>
                                <span class="price">${p.price} DT</span>
                            </div>
                            <p style="color:#aaa; font-size:14px; margin: 10px 0;">${p.desc}</p>
                            
                            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                                <button class="btn-main btn-wa" onclick="window.open('https://wa.me/${p.phone}')"><i class="fa-brands fa-whatsapp"></i> ÙˆØ§ØªØ³Ø§Ø¨</button>
                                <button class="btn-main btn-chat" onclick="sendInAppMessage('${p.email}', '${p.game}', '${p.d17}')">Ø¯Ø±Ø¯Ø´Ø©</button>
                            </div>
                            ${p.d17 ? `<button class="btn-main" style="background:#007bff; color:#fff;" onclick="alert('Ø±Ù‚Ù… Ø§Ù„Ù€ D17 Ù„Ù„Ø¨Ø§Ø¦Ø¹: ${p.d17}\\n\\nÙ‚Ù… Ø¨Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø«Ù… Ø£Ø±Ø³Ù„ Ø§Ù„ÙˆØµÙ„ ÙÙŠ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©')"><i class="fa-solid fa-credit-card"></i> Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯ÙØ¹</button>` : ''}
                        </div>
                    </div>`;
            });
        }

        // Ù†Ø¸Ø§Ù… Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©
        function sendInAppMessage(toEmail, gameName, d17) {
            const user = JSON.parse(localStorage.getItem('user'));
            if(user.email === toEmail) return alert("Ù‡Ø°Ø§ Ø¹Ø±Ø¶Ùƒ Ø§Ù„Ø®Ø§Øµ!");
            
            const msg = prompt(`Ø£Ø±Ø³Ù„ Ø±Ø³Ø§Ù„Ø© Ù„Ù„Ø¨Ø§Ø¦Ø¹ Ø¨Ø®ØµÙˆØµ ${gameName}:`);
            if(!msg) return;

            const allMessages = JSON.parse(localStorage.getItem('appMessages') || "[]");
            allMessages.push({
                to: toEmail,
                from: user.name,
                game: gameName,
                text: msg,
                date: new Date().toLocaleTimeString()
            });
            localStorage.setItem('appMessages', JSON.stringify(allMessages));
            alert("ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„ØªÙƒ!");
        }

        function renderMessages() {
            const user = JSON.parse(localStorage.getItem('user'));
            const msgs = JSON.parse(localStorage.getItem('appMessages') || "[]").filter(m => m.to === user.email);
            const list = document.getElementById('messagesList');
            list.innerHTML = msgs.length ? "" : "<p style='color:#666; font-size:13px;'>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±Ø³Ø§Ø¦Ù„ Ø­Ø§Ù„ÙŠØ§Ù‹.</p>";
            msgs.reverse().forEach(m => {
                list.innerHTML += `
                    <div class="chat-msg">
                        <small style="color:var(--primary)">Ù…Ù†: ${m.from} | Ø¨Ø®ØµÙˆØµ: ${m.game}</small>
                        <p style="margin:5px 0;">${m.text}</p>
                        <small style="font-size:9px; color:#555">${m.date}</small>
                    </div>`;
            });
        }

        function renderMyPosts() {
            const user = JSON.parse(localStorage.getItem('user'));
            const myPosts = JSON.parse(localStorage.getItem('gamePosts') || "[]").filter(p => p.email === user.email);
            const list = document.getElementById('myPostsList');
            list.innerHTML = myPosts.length ? "" : "<p style='color:#666; font-size:13px;'>Ù„Ù… ØªÙ†Ø´Ø± Ø£ÙŠ Ø¹Ø±Ø¶ Ø¨Ø¹Ø¯.</p>";
            myPosts.forEach(p => {
                list.innerHTML += `
                    <div style="background:#1f1f1f; padding:10px; border-radius:10px; margin-bottom:5px; display:flex; justify-content:space-between;">
                        <span>${p.game}</span>
                        <b style="color:var(--primary)">${p.price} DT</b>
                    </div>`;
            });
        }

        function showPage(id, btn) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active-link'));
            btn.classList.add('active-link');
            if(id === 'home') renderPosts();
            if(id === 'profile') { renderMessages(); renderMyPosts(); }
        }

        function logout() { localStorage.removeItem('user'); location.reload(); }

        window.onload = () => {
            const user = JSON.parse(localStorage.getItem('user'));
            if(user) {
                document.getElementById('auth-screen').style.display = 'none';
                document.getElementById('profile-name').innerText = user.name;
                document.getElementById('profile-email').innerText = user.email;
                renderPosts();
            }
        };
    </script>
</body>
</html>
